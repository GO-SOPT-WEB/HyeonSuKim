# 웹 최적화는 무엇일까?
웹 최적화란, 브라우저의 로딩 성능과 렌더링 성능을 높여, 사용자에게 필요한 화면을 빠르게 paint 하고, re-render 가 빈번하게 일어나는 코드도 화면에서 부드럽게 연속적으로 paint 될 수 있게끔 조치를 취하는 것입니다. 
# 최적화가 필요한 이유는 무엇일까?
먼저 로딩 성능 최적화가 필요한 이유는, 사용자들은 자신에게 필요한 정보를 얻을 수 있는 시간이 늦어질수록 사이트를 이탈할 확률이 높아지기 때문입니다. 사용자가 페이지를 떠난다는 것은 곧, 이 웹사이트에서 얻을 수 있는 수익이 감소한다는 것이기 때문에 로딩 성능 최적화를 통해 유저 이탈률을 최소화하는 것이 중요합니다.
렌더링 성능 최적화가 필요한 이유는, 연속적인 화면을 그려내 사용자가 원하는 작업을 안정적으로 수행할 수 있도록 하기 위함입니다. 일반적으로 사용자가 화면이 연속적이다고 느끼는 렌더링 속도가 60FPS인데, 이는 곧 1초에 약 60 frame 을 화면에 paint 해야함을 의미합니다. 만약 렌더링 속도가 느리다면, frame을 충분히 그려내지 못하고, 이에 따라 브라우저는 (사용자가 느끼기에) 불연속적인 화면을 그리게 됩니다. 이는 사용자와의 빈번한 인터랙션이 필요한 경우, 사용자가 의도하지 않은 결과를 도출할 수도 있고 게임 등 그래픽 작업이 많은 경우, 사용자가 원하는 ui 를 그려내지 못할 수 있습니다. 
# 이를 위해 어떤 개발을 해야할까?
### 로딩 성능 최적화를 위해 할 수 있는 방법:
로딩 성능 최적화는 크게 브라우저 성능 최적화와 사용자 기준 최적화로 나뉩니다. 이때, 브라우저 성능 최적화는 DomContentLoadedEvent 와 load event의 실행 시점을 앞당김으로써 실현됩니다. DomContentLoadedEvent 는 브라우저가 html, css, js 를 파싱하는 단계이고 load event는 파싱이 끝난 뒤 html 이 포함하고 있는 이미지 등의 리소스가 모두 로딩되었을 때 발생하는 단계입니다. 
여기서 잠깐! 브라우저가 렌더링을 하는 과정에 대해서 알아보도록 하겠습니다. 브라우저는 Critical Rendering Path 에 따라 렌더링을 진행합니다. 최초로 html 을 파싱해서 Dom Tree 를 만들고, css 를 파싱해서 CSSOM Tree 를 만들고, 이 둘을 이용해 Render Tree 를 만들어 Layout 작업을 통해 요소들의 크기를 재고, paint 를 한 뒤 Layer 를 실제 화면에 나타내게 됩니다. 이때, html 코드에서 css 나 js 성분을 만나면, html 파싱을 잠시 중단하고 CSSOM Tree 와 Dom Tree 를 준비시킵니다. (html의 파싱을 중단시키는 css, js 를 블록 리소스라고 합니다.) 따라서 이 블록 리소스를 처리하는 동안에, 브라우저는 html 을 파싱할 수 없으므로, paint 작업을 수행할 수 없습니다. 
본론으로 돌아와서, 이러한 이유로, 이 블록 리소스들을 잘 처리해 주고, html 의 파싱을 신속히 하는 것이 브라우저 관점에서의 로딩 성능 최적화입니다. 먼저 js는, <script> 태그를 </body> 태그 하단에 두거나 <head> 태그 내에 두되, defer 나 async 를 사용함으로써 로딩 최적화를 실현할 수 있습니다. 한편 css 는, 브라우저가 css 다운로드를 waiting 하는 시간을 줄이는 것이 중요한데, 이는 inline 스타일의 css 를 사용하면, 다시 말해 html 자체에 css 를 포함시키면 css 다운로드 요청이 줄어들게 되어 waiting time 이 감소하게 되고, 이에 따라 로딩 최적화가 가능해집니다.
그런데 이러한 브라우저 관점의 로딩 최적화는, DOMContentLoaded 시간은 앞당겨주지만, Load event 의 시간은 앞당기지 못해, 실제 사용자에게 필요한 정보를 빠르게 로딩하지 못한다는 한계가 있습니다. 
이에 구글에서는 사용자 기준 최적화 방법을 제안했습니다. 페이지가 로딩될 때, First Meaningful Paint 즉 사용자에게 의미있는 컨텐츠가 paint 되는 시간을 앞당기는 것입니다. 그리고 SPA 환경에서 이를 가능케 해 주는 것이 Server Side Rendering 입니다. 
### 렌더링 성능 최적화를 위해 할 수 있는 방법: 
렌더링 성능을 최적화하는 방법에는 크게 세 가지가 있습니다.
1. 레이아웃 스레싱이 일어나는 경우는 캐싱을 이용하기. 
강제 동기 레이아웃이 빈번하게 발생하는 경우를 레이아웃 스레싱이라고 합니다. 강제 동기 레이아웃이란, DOM 을 수정하지 않았음에도 불구하고 렌더링이 다시 되어 레이아웃 과정이 의도와 달리 강제로 발생하는 것을 의미합니다. 레이아웃 작업은 요소의 크기를 일일이 계산해야 하는, 계산량이 많은 프로세스이기 때문에 렌더링 속도를 크게 저하시킵니다. 따라서 레이아웃 스레싱이 일어나는 경우는, 캐시 메모리를 사용하여 렌더링 성능을 향상시킬 수 있습니다. 
2. 가상 DOM 이용하기. 
렌더링 과정 중에서 돔 변경이 감지되면, 렌더링은 새로 일어나야 합니다. 이때 가상돔은 돔 전체를 렌더링하는 것이 아니라, 돔 변경이 일어난 부분만 변경하기 때문에 효율적으로 렌더링할 수 있게 됩니다. 특히나 이 작업을 가상 DOM이 자체적으로 수행하므로, 프로그래밍도 수월해진다는 추가적인 장점도 있습니다. 
3. 무거운 작업은 메인 스레드가 아닌 웹 워커에 옮기기.
운영체제에 대한 배경지식이 있다면, 프로세스 중에는 입출력처럼 수행 시간이 긴 프로세스가 있다는 사실을 알고 있을 것입니다. 프로그램 코드 중에서도 특정 코드는 계산량이 많아 수행 시간이 긴 코드가 있을 수 있습니다. 이 경우 메인 쓰레드를 오랜 시간 점유하면 사용자에게 더 필요한 프로세스를 수행하는 데 방해가 되기 때문에, 이는 웹 워커라는 백그라운드 스레드로 옮겨 수행하는 것이 렌더링 성능을 최적화 하는 데에 도움이 됩니다.
# 최적화를 위한 개발을 꼭 해야할까?
웹 성능 최적화는 결국, UX 를 향상시켜 사용자가 웹 사용에 불편함이 없도록 하기 위함입니다. 사용자가 웹 사용에 불편함을 느낄수록, 사용자의 웹 이용률이 떨어지고, 이는 곧 해당 웹사이트가 창출 가능한 이익의 감소와 직접적으로 연관되기 때문에 최적화를 위한 개발은 꼭 필요하다고 생각합니다.